<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Responsive Concentric Circles</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    /* Base styles with CSS variables for easy theme customization */
    :root {
      --primary-bg: #ffffff;
      --text-color: #333333;
      --circle-stroke: #ffffff;
      --circle-fill-1: #DCDCDC;
      --circle-fill-2: #ffffff;
      --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    }

    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      overscroll-behavior: none;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--primary-bg);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      -webkit-user-select: none;
      user-select: none;
    }

    /* Chart container styles */
    #chart {
      width: 100vw;
      height: 100vh;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    /* Zoom container styles */
    .zoom-pan-container {
      position: absolute;
      width: 100%;
      height: 100%;
      transform-origin: center;
      will-change: transform;
      transition: transform 0.1s ease-out;
    }

    /* SVG styles */
    svg {
      width: 100%;
      height: 100%;
      touch-action: none;
      transform-origin: center;
    }

    /* Text styles */
    svg text {
      font-family: var(--font-family);
      pointer-events: none;
      dominant-baseline: middle;
    }

    /* Responsive text sizing */
    @media (max-width: 768px) {
      svg text {
        font-size: calc(8px + 1vmin);
      }
    }

    @media (max-width: 480px) {
      svg text {
        font-size: calc(6px + 1vmin);
      }
    }

    /* High DPI screen optimizations */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      svg {
        shape-rendering: geometricPrecision;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --primary-bg: #1a1a1a;
        --text-color: #ffffff;
        --circle-fill-1: #2d2d2d;
        --circle-fill-2: #3d3d3d;
      }
    }

    /* Touch-specific styles */
    @media (hover: none) and (pointer: coarse) {
      .touch-target {
        min-width: 44px;
        min-height: 44px;
      }
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>
    // Updated data for each circle
    const rawData1 = `1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0`;

const rawData2 = `1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0`;

// Continuation of rawData3
const rawData3 = `1/-420/1/1,2/-419/2/13,3/-418/3/25,4/-417/4/37,5/-416/5/49,6/-415/6/1,7/-414/7/13,8/-413/8/25,9/-412/9/37,10/-411/10/49,11/-410/11/1,12/-409/12/13,13/-408/13/25,14/-407/14/37,15/-406/15/49,16/-405/16/1,17/-404/17/13,18/-403/18/25,19/-402/19/37,20/-401/20/49,21/-400/21/1,22/-399/22/13,23/-398/23/25,24/-397/24/37,25/-396/25/49,26/-395/26/1,27/-394/27/13,28/-393/28/25,29/-392/29/37,30/-391/30/49,31/-390/31/1,32/-389/32/13,33/-388/33/25,34/-387/34/37,35/-386/35/49,36/-385/36/1,37/-384/37/13,38/-383/38/25,39/-382/39/37,40/-381/40/49,41/-380/41/1,42/-379/42/13,43/-378/43/25,44/-377/44/37,45/-376/45/49,46/-375/46/1,47/-374/47/13,48/-373/48/25,49/-372/49/37,50/-371/50/49,51/-370/51/1,52/-369/52/13,53/-368/53/25,54/-367/54/37,55/-366/55/49,56/-365/56/1,57/-364/57/13,58/-363/58/25,59/-362/59/37,60/-361/60/49,61/-360/1/1,62/-359/2/13,63/-358/3/25,64/-357/4/37,65/-356/5/49,66/-355/6/1,67/-354/7/13,68/-353/8/25,69/-352/9/37,70/-351/10/49,71/-350/11/1,72/-349/12/13,73/-348/13/25,74/-347/14/37,75/-346/15/49,76/-345/16/1,77/-344/17/13,78/-343/18/25,79/-342/19/37,80/-341/20/49,81/-340/21/1,82/-339/22/13,83/-338/23/25,84/-337/24/37,85/-336/25/49,86/-335/26/1,87/-334/27/13,88/-333/28/25,89/-332/29/37,90/-331/30/49,91/-330/31/1,92/-329/32/13,93/-328/33/25,94/-327/34/37,95/-326/35/49,96/-325/36/1,97/-324/37/13,98/-323/38/25,99/-322/39/37,100/-321/40/49,101/-320/41/1,102/-319/42/13,103/-318/43/25,104/-317/44/37,105/-316/45/49,106/-315/46/1,107/-314/47/13,108/-313/48/25,109/-312/49/37,110/-311/50/49,111/-310/51/1,112/-309/52/13,113/-308/53/25,114/-307/54/37,115/-306/55/49,116/-305/56/1,117/-304/57/13,118/-303/58/25,119/-302/59/37,120/-301/60/49,121/-300/1/1,122/-299/2/13,123/-298/3/25,124/-297/4/37,125/-296/5/49,126/-295/6/1,127/-294/7/13,128/-293/8/25,129/-292/9/37,130/-291/10/49,131/-290/11/1,132/-289/12/13,133/-288/13/25,134/-287/14/37,135/-286/15/49,136/-285/16/1,137/-284/17/13,138/-283/18/25,139/-282/19/37,140/-281/20/49,141/-280/21/1,142/-279/22/13,143/-278/23/25,144/-277/24/37,145/-276/25/49,146/-275/26/1,147/-274/27/13,148/-273/28/25,149/-272/29/37,150/-271/30/49,151/-270/31/1,152/-269/32/13,153/-268/33/25,154/-267/34/37,155/-266/35/49,156/-265/36/1,157/-264/37/13,158/-263/38/25,159/-262/39/37,160/-261/40/49,161/-260/41/1,162/-259/42/13,163/-258/43/25,164/-257/44/37,165/-256/45/49,166/-255/46/1,167/-254/47/13,168/-253/48/25,169/-252/49/37,170/-251/50/49,171/-250/51/1,172/-249/52/13,173/-248/53/25,174/-247/54/37,175/-246/55/49,176/-245/56/1,177/-244/57/13,178/-243/58/25,179/-242/59/37,180/-241/60/49,181/-240/1/1,182/-239/2/13,183/-238/3/25,184/-237/4/37,185/-236/5/49,186/-235/6/1,187/-234/7/13,188/-233/8/25,189/-232/9/37,190/-231/10/49,191/-230/11/1,192/-229/12/13,193/-228/13/25,194/-227/14/37,195/-226/15/49,196/-225/16/1,197/-224/17/13,198/-223/18/25,199/-222/19/37,200/-221/20/49,201/-220/21/1,202/-219/22/13,203/-218/23/25,204/-217/24/37,205/-216/25/49,206/-215/26/1,207/-214/27/13,208/-213/28/25,209/-212/29/37,210/-211/30/49,211/-210/31/1,212/-209/32/13,213/-208/33/25,214/-207/34/37,215/-206/35/49,216/-205/36/1,217/-204/37/13,218/-203/38/25,219/-202/39/37,220/-201/40/49,221/-200/41/1,222/-199/42/13,223/-198/43/25,224/-197/44/37,225/-196/45/49,226/-195/46/1,227/-194/47/13,228/-193/48/25,229/-192/49/37,230/-191/50/49,231/-190/51/1,232/-189/52/13,233/-188/53/25,234/-187/54/37,235/-186/55/49,236/-185/56/1,237/-184/57/13,238/-183/58/25,239/-182/59/37,240/-181/60/49,241/-180/1/1,242/-179/2/13,243/-178/3/25,244/-177/4/37,245/-176/5/49,246/-175/6/1,247/-174/7/13,248/-173/8/25,249/-172/9/37,250/-171/10/49,251/-170/11/1,252/-169/12/13,253/-168/13/25,254/-167/14/37,255/-166/15/49,256/-165/16/1,257/-164/17/13,258/-163/18/25,259/-162/19/37,260/-161/20/49,261/-160/21/1,262/-159/22/13,263/-158/23/25,264/-157/24/37,265/-156/25/49,266/-155/26/1,267/-154/27/13,268/-153/28/25,269/-152/29/37,270/-151/30/49,271/-150/31/1,272/-149/32/13,273/-148/33/25,274/-147/34/37,275/-146/35/49,276/-145/36/1,277/-144/37/13,278/-143/38/25,279/-142/39/37,280/-141/40/49,281/-140/41/1,282/-139/42/13,283/-138/43/25,284/-137/44/37,285/-136/45/49,286/-135/46/1,287/-134/47/13,288/-133/48/25,289/-132/49/37,290/-131/50/49,291/-130/51/1,292/-129/52/13,293/-128/53/25,294/-127/54/37,295/-126/55/49,296/-125/56/1,297/-124/57/13,298/-123/58/25,299/-122/59/37,300/-121/60/49,301/-120/1/1,302/-119/2/13,303/-118/3/25,304/-117/4/37,305/-116/5/49,306/-115/6/1,307/-114/7/13,308/-113/8/25,309/-112/9/37,310/-111/10/49,311/-110/11/1,312/-109/12/13,313/-108/13/25,314/-107/14/37,315/-106/15/49,316/-105/16/1,317/-104/17/13,318/-103/18/25,319/-102/19/37,320/-101/20/49,321/-100/21/1,322/-99/22/13,323/-98/23/25,324/-97/24/37,325/-96/25/49,326/-95/26/1,327/-94/27/13,328/-93/28/25,329/-92/29/37,330/-91/30/49,331/-90/31/1,332/-89/32/13,333/-88/33/25,334/-87/34/37,335/-86/35/49,336/-85/36/1,337/-84/37/13,338/-83/38/25,339/-82/39/37,340/-81/40/49,341/-80/41/1,342/-79/42/13,343/-78/43/25,344/-77/44/37,345/-76/45/49,346/-75/46/1,347/-74/47/13,348/-73/48/25,349/-72/49/37,350/-71/50/49,351/-70/51/1,352/-69/52/13,353/-68/53/25,354/-67/54/37,355/-66/55/49,356/-65/56/1,357/-64/57/13,358/-63/58/25,359/-62/59/37,360/-61/60/49,361/-60/1/1,362/-59/2/13,363/-58/3/25,364/-57/4/37,365/-56/5/49,366/-55/6/1,367/-54/7/13,368/-53/8/25,369/-52/9/37,370/-51/10/49,371/-50/11/1,372/-49/12/13,373/-48/13/25,374/-47/14/37,375/-46/15/49,376/-45/16/1,377/-44/17/13,378/-43/18/25,379/-42/19/37,380/-41/20/49,381/-40/21/1,382/-39/22/13,383/-38/23/25,384/-37/24/37,385/-36/25/49,386/-35/26/1,387/-34/27/13,388/-33/28/25,389/-32/29/37,390/-31/30/49,391/-30/31/1,392/-29/32/13,393/-28/33/25,394/-27/34/37,395/-26/35/49,396/-25/36/1,397/-24/37/13,398/-23/38/25,399/-22/39/37,400/-21/40/49,401/-20/41/1,402/-19/42/13,403/-18/43/25,404/-17/44/37,405/-16/45/49,406/-15/46/1,407/-14/47/13,408/-13/48/25,409/-12/49/37,410/-11/50/49,411/-10/51/1,412/-9/52/13,413/-8/53/25,414/-7/54/37,415/-6/55/49,416/-5/56/1,417/-4/57/13,418/-3/58/25,419/-2/59/37,420/-1/60/49`;

// Continuing rawData4...
const rawData4 = `1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0`;

const rawData5 = `1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0`;

const rawData6 = `1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0`;
   
// Add after the rawData6 declaration...

// Parse the data for each circle
function parseCircleData(rawData, format) {
  if (format === 'simple') {
    return rawData.split(',').map(d => ({ id: +d }));
  } else if (format === 'complex') {
    return rawData.split(',').map(d => {
      const [id, data, data1, data2] = d.split('/');
      return {
        id: +id,
        data: +data,
        data1: +data1,
        data2: +data2
      };
    });
  }
}

// Circle configurations
const circleData = [
  { data: parseCircleData(rawData1, 'simple'), radius: 200, name: 'circle1' },
  { data: parseCircleData(rawData2, 'simple'), radius: 280, name: 'circle2' },
  { data: parseCircleData(rawData3, 'complex'), radius: 360, name: 'circle3' },
  { data: parseCircleData(rawData4, 'simple'), radius: 440, name: 'circle4' },
  { data: parseCircleData(rawData5, 'simple'), radius: 520, name: 'circle5' },
  { data: parseCircleData(rawData6, 'simple'), radius: 600, name: 'circle6' }
];

// Size and margins
let width = window.innerWidth;
let height = window.innerHeight;
const margin = Math.min(width, height) * 0.1;

// Initialize zoom state
let currentScale = 1;
let currentTranslateX = 0;
let currentTranslateY = 0;
let initialDistance = 0;
let initialScale = 1;
let isPanning = false;
let lastTouchX = 0;
let lastTouchY = 0;

// Color scale for alternating background colors
const color = d3.scaleOrdinal()
  .domain(d3.range(0, 420, 7))
  .range(["#DCDCDC", "#ffffff"]);

// Create container for zoom and pan
const container = d3.select("#chart")
  .append("div")
  .attr("class", "zoom-pan-container");

// Create SVG
const svg = container
  .append("svg")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("viewBox", `0 0 ${width} ${height}`)
    .attr("preserveAspectRatio", "xMidYMid meet");

// Center point    
const center = {x: width/2, y: height/2};

// Create groups for each circle
const circles = circleData.map(circle => {
  return {
    ...circle,
    group: svg.append("g")
      .attr("transform", `translate(${center.x}, ${center.y})`)
      .attr("class", circle.name),
    currentRotation: 0
  };
});

// Generate pie layout
const pie = d3.pie()
  .sort((a, b) => a.id - b.id)
  .value(1);

// Function to update each circle
function updateCircle(circle, rotation = 0) {
  const textArc = d3.arc()
    .innerRadius(circle.radius - 50)
    .outerRadius(circle.radius)
    .padAngle(1/circle.radius);

  // Draw arc slices
  circle.group.selectAll("path")
    .data(pie(circle.data))
    .join("path")
      .attr("d", textArc)
      .attr("fill", (d, i) => color(Math.floor(i / 7) * 7))
      .attr("stroke", "white")
      .attr("stroke-width", 1);

  // Add text labels with complex data handling
  circle.group.selectAll("text")
    .data(pie(circle.data))
    .join("text")
      .attr("transform", d => {
        const [x, y] = textArc.centroid(d);
        const rotate = (textArc.startAngle()(d) + textArc.endAngle()(d)) / 2 * 180 / Math.PI - 90;
        return `translate(${x}, ${y}) rotate(${rotate})`;
      })
      .attr("dy", "0.35em")
      .style("text-anchor", "middle")
      .text(d => {
        if (d.data.data !== undefined) {
          return `${d.data.id}/${d.data.data1}/${d.data.data2}`;
        }
        return `${d.data.id}`;
      })
      .style("font-size", `${circle.radius * 0.02}px`);

  circle.group.attr("transform", `translate(${center.x}, ${center.y}) rotate(${rotation})`);
}

// Function to handle zoom
function handleZoom(event) {
  if (event.touches && event.touches.length === 2) {
    const touch1 = event.touches[0];
    const touch2 = event.touches[1];
    const distance = Math.hypot(
      touch2.clientX - touch1.clientX,
      touch2.clientY - touch1.clientY
    );

    if (initialDistance === 0) {
      initialDistance = distance;
      initialScale = currentScale;
    } else {
      currentScale = initialScale * (distance / initialDistance);
      currentScale = Math.min(Math.max(currentScale, 0.5), 3); // Limit zoom range
      container.style("transform", 
        `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`);
    }
    event.preventDefault();
  }
}

// Function to handle pan
function handlePan(event) {
  if (event.touches && event.touches.length === 2) {
    const touch = event.touches[0];
    if (!isPanning) {
      isPanning = true;
      lastTouchX = touch.clientX;
      lastTouchY = touch.clientY;
    } else {
      const deltaX = touch.clientX - lastTouchX;
      const deltaY = touch.clientY - lastTouchY;
      currentTranslateX += deltaX;
      currentTranslateY += deltaY;
      container.style("transform", 
        `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`);
      lastTouchX = touch.clientX;
      lastTouchY = touch.clientY;
    }
    event.preventDefault();
  }
}

// Initialize circles and event handlers
circles.forEach(circle => {
  let startAngle = 0;
  let isRotating = false;
  let activeCircle = null;

  function handleStart(clientX, clientY, targetCircle) {
    const clickRadius = Math.sqrt(
      Math.pow(clientX - center.x, 2) + 
      Math.pow(clientY - center.y, 2)
    );

    if (Math.abs(clickRadius - targetCircle.radius) < 50) {
      isRotating = true;
      activeCircle = targetCircle;
      startAngle = Math.atan2(clientY - center.y, clientX - center.x);
    }
  }

  function handleMove(clientX, clientY) {
    if (isRotating && activeCircle === circle) {
      const endAngle = Math.atan2(clientY - center.y, clientX - center.x);
      const deltaAngle = endAngle - startAngle;
      circle.currentRotation += deltaAngle * 180 / Math.PI;
      updateCircle(circle, circle.currentRotation);
      startAngle = endAngle;
    }
  }

  function handleEnd() {
    isRotating = false;
    activeCircle = null;
    initialDistance = 0;
    isPanning = false;
  }

  // Mouse events
  svg.on("mousedown.circle" + circle.name, function(event) {
    event.preventDefault();
    handleStart(event.clientX, event.clientY, circle);
  });

  svg.on("mousemove.circle" + circle.name, function(event) {
    event.preventDefault();
    handleMove(event.clientX, event.clientY);
  });

  svg.on("mouseup.circle" + circle.name, handleEnd);
  svg.on("mouseleave.circle" + circle.name, handleEnd);

  // Touch events with zoom and pan support
  svg.on("touchstart.circle" + circle.name, function(event) {
    event.preventDefault();
    if (event.touches.length === 1) {
      const touch = event.touches[0];
      handleStart(touch.clientX, touch.clientY, circle);
    }
  });

  svg.on("touchmove.circle" + circle.name, function(event) {
    event.preventDefault();
    if (event.touches.length === 1) {
      const touch = event.touches[0];
      handleMove(touch.clientX, touch.clientY);
    }
  });

  svg.on("touchend.circle" + circle.name, handleEnd);
  svg.on("touchcancel.circle" + circle.name, handleEnd);
});

// Add zoom and pan event listeners
container.node().addEventListener('touchstart', handleZoom, { passive: false });
container.node().addEventListener('touchmove', (event) => {
  handleZoom(event);
  handlePan(event);
}, { passive: false });
container.node().addEventListener('touchend', () => {
  initialDistance = 0;
  isPanning = false;
}, { passive: false });

// Initial draw of all circles
circles.forEach(circle => updateCircle(circle));

// Responsive design
function resizeChart() {
  width = window.innerWidth;
  height = window.innerHeight;
  
  svg.attr("viewBox", `0 0 ${width} ${height}`);
  
  center.x = width/2;
  center.y = height/2;
  
  circles.forEach(circle => {
    updateCircle(circle, circle.currentRotation);
  });
}

window.addEventListener('resize', resizeChart);

  </script>
</body>
</html>